#!/bin/bash
# ADD -vx after bash to echo expanded script

# VARIABLES ==========

RED='\033[0;31m'
CYAN='\033[1;36m'
NC='\033[0m'
input="ENTER"

# FUNCTIONS ==========

function pause {
  echo -e "\n${CYAN}Press any key to Continue${NC}\n"
  read -n 1 -s -r
  menu
}

function one {
  clear
  echo -e "\n1) Initialization Wizard\n"
  read -p "Enter Host Name: " bizhost
  if [[ ! ( -z "$bizhost" ) ]]; then
    echo -e "$bizhost" > $HOME/.bizhost
  fi
  echo -e "\nOperation Complete"
  pause
  menu
}

function two {
  clear
  echo -e "\n2) Option 2\n"
  echo -e "\nOperation Complete"
  pause
  menu
}

function three {
  clear
  echo -e "\n3) Option 3\n"
  echo -e "\nOperation Complete"
  pause
  menu
}

function finish {
stty echo
# restore screen
echo -e "\e[?1049l"
read -N 10000000 -t 0.01
exec bash
exit 0
}

function menu {
clear
figlet "BizNet"
echo -e " ** ${CYAN}BizNet Setup Script${NC} **\n"

echo "1) Initialization Wizard"
echo "2) Option 2..."
echo "3) Option 3..."
echo "X) Exit"

echo -e "\nMake a Selection\n"
input
}

function input {
read -N 10000000 -t 0.01
read -n 1 -s -r input
case $input in
  1)
    one
  ;;
  2)
    two
  ;;
  3)
    three
  ;;
  $'\e[A')
    # THIS IS NOT WORKING TO CAPTURE ARROW KEYS without -n 2
    stty -echo
    echo -e "${RED} <<<Invalid>>>${NC}"
    # Beep
    echo -e "\a"
    sleep 0.5
    stty echo
    menu
  ;;
  x|X|$'\e')
    finish
  ;;
  *)
    stty -echo
    echo -e "${RED} <<<Invalid>>>${NC}"
    # Beep
    echo -e "\a"
    sleep 0.2
    stty echo
    menu
  ;;
esac
}

# EXECUTE ==========

# save screen
echo -e "\e[?1049h"

# draw menu
menu

# ERROR ==========

# restore screen and exit
echo "ERROR - This should not have happened"
echo -e "\e[?1049l"
read -N 10000000 -t 0.01
exec bash
exit 1
